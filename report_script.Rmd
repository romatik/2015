---
title: "Title of the report"
author: "Course Quality Advisory Board"
date: "September 2, 2015"
output: html_document
toc: yes
numbersections: yes
header-includes:
    - \usepackage{xcolor}
    - \setlength{\tabcolsep}{3pt}
    - \definecolor{light-gray}{gray}{0.87}
    - \usepackage{fancyhdr}
    - \pagestyle{fancy}
    - \lfoot{\includegraphics[width=0.75cm]{logo_ema.png}}
    - \cfoot{\fontsize{8}{12} \selectfont `r as.character(tenormore$Course[i])`}
    - \rfoot{\thepage}  
---

```{r, echo = FALSE}
#headers - http://tex.stackexchange.com/questions/139139/adding-headers-and-footers-using-pandoc
suppressWarnings(suppressPackageStartupMessages(library(ggplot2)))
suppressWarnings(suppressPackageStartupMessages(library(dplyr)))
suppressWarnings(suppressPackageStartupMessages(library(likert)))
suppressWarnings(suppressPackageStartupMessages(library(stringr)))
suppressWarnings(suppressPackageStartupMessages(library(scales)))
suppressWarnings(suppressPackageStartupMessages(library(psych)))
suppressWarnings(suppressPackageStartupMessages(library(grid)))
suppressWarnings(suppressPackageStartupMessages(library(RColorBrewer)))
suppressWarnings(suppressPackageStartupMessages(library(xtable)))
suppressWarnings(suppressPackageStartupMessages(library(tidyr)))

library(knitr)
library(markdown)
library(rmarkdown)
library(dplyr)
library(likert)
library(scales)
library(psych)
library(reshape)
library(grid)
library(RColorBrewer)
library(xtable)
library(tidyr)
options(xtable.comment = FALSE)
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE, results = 'asis')
```

\pagebreak

#Introduction
##Course Quality Advisory Board
C-QAB is a voluntary student organization comprised of current and past Erasmus Mundus students. The focus of C-QAB is to facilitate communication between the Association and the Erasmus Mundus programmes. C-QAB accomplishes this by coordinating the EMA Programme Representatives, conducting an annual student services satisfaction survey and responding to student concerns through its email account. 

If you have any concerns or would like to request some additional information, feel free to contact us through e-mail: em.feedback@em-a.eu.

##Some stuff about the survey
Number of respondents, number of courses with 10+ respondents, tables with coverage and response rates.

##Structure of the document

There are four sections each represented by multiple questions. Each question is explained through a graph and a table. 

Graph plots the responses from students, while table provides information about how other courses did on that question. Example of a table below:

```{r}
df <- comparative_df(questions[1], course_dataset)
df <- df[1:3,]
z <- xtable(df, caption = sprintf("Example of a table"), digits = c(0,0,2,2,2,2,2,2), type = "html")
align(z) <- "|p{5cm}|cc|c|cccc|"
print(z, table.placement="h", floating = FALSE, NA.string = "NA", sanitize.text.function = function(x) x)
```

Each row represents a dimension of the question. It contains information about the mean that question received from students of your program. 

Calculation of means is based on Likert-scale. Each option corresponds to a numeric value in a following way:

  1. "Very unsatisfied" or "Disagree"= 1.
  2. "Unsatisfied" or "Somewhat disagree"= 2.
  3. "Satisfied" or "Somewhat agree" = 3.
  4. "Very satisfied" or "Agree" = 4.

Therefore, average score for any given dimension in a table ranges from a minimum of 1 to a maximum of 4, with 4 being a perfect score for each dimension. 

Following that is the mean for all respondents of the survey. Finally, table provides information about distribution of means in all other courses. Distribution is represented by quantiles. This means that 25% of courses will lie in each of the columns. This enables easy comparison of any given program with its peers. The column with the score of your program is highlighted.

Important note: Throughout this report only dimensions with at least 10 respondents will be used. That means that some questions will have less dimensions or may be even missing altogether.

## Executive summary (?)

```{r}
z <- c("C.3.Please.rate.academic.satisfaction.with.EM.course._", 
       "C.4.Please.rate.overall.satisfaction.with.EM.course._",
       "N.5.1.Please.rate.overall.satisfaction.at.the.first.university._",
       "O.5.1.Please.rate.overall.satisfaction.at.the.second.university._",
       "P.5.1.Please.rate.overall.satisfaction.at.the.third.university._",
       "Q.5.1.Please.rate.overall.satisfaction.at.the.fourth.university._")
question <- course_dataset[, z]
for(i in seq_along(question)) {
  ### this step will also reduce all other answers to NA's
  question[,i] <- factor(question[,i], levels = likert_levels)
}
names(question) <- c("Overall academic satisfaction", 
                     "Overall satisfaction",
                     "Overall satisfaction in 1st university",
                     "Overall satisfaction in 2nd university",
                     "Overall satisfaction in 3rd university",
                     "Overall satisfaction in 4th university")
question <- question[, colSums(!is.na(question)) >= 10]
```
```{r, fig.height = 1 + 0.5*ncol(question)}
p <- plot_question(question, "Overall satisfaction")
plot(p)
```

\pagebreak

#Supporting services

```{r, fig.height = figure_height("B.1.1", course_dataset)}
report_question("B.1.1", course_dataset)
```
```{r, fig.height = figure_height("N.1.1", course_dataset)}
report_question("N.1.1", course_dataset)
```
```{r, fig.height = figure_height("O.1.1", course_dataset)}
report_question("O.1.1", course_dataset)
```
```{r, fig.height = figure_height("P.1.1", course_dataset)}
report_question("P.1.1", course_dataset)
```
```{r, fig.height = figure_height("Q.1.1", course_dataset)}
report_question("Q.1.1", course_dataset)

```

```{r, fig.height = figure_height("B.1.3", course_dataset)}
report_question("B.1.3", course_dataset)
```
```{r, fig.height = figure_height("N.1.3", course_dataset)}
report_question("N.1.3", course_dataset)
```
```{r, fig.height = figure_height("O.1.3", course_dataset)}
report_question("O.1.3", course_dataset)
```
```{r, fig.height = figure_height("P.1.3", course_dataset)}
report_question("P.1.3", course_dataset)
```
```{r, fig.height = figure_height("Q.1.3", course_dataset)}
report_question("Q.1.3", course_dataset)
```


```{r, fig.height = figure_height("B.2.1", course_dataset)}
report_question("B.2.1", course_dataset)
```
```{r, fig.height = figure_height("N.2.1", course_dataset)}
report_question("N.2.1", course_dataset)
```
```{r, fig.height = figure_height("O.2.1", course_dataset)}
report_question("O.2.1", course_dataset)
```
```{r, fig.height = figure_height("P.2.1", course_dataset)}
report_question("P.2.1", course_dataset)
```
```{r, fig.height = figure_height("Q.2.1", course_dataset)}
report_question("Q.2.1", course_dataset)
```


```{r, fig.height = figure_height("B.2.2", course_dataset)}
report_question("B.2.2", course_dataset)
```
```{r, fig.height = figure_height("N.2.2", course_dataset)}
report_question("N.2.2", course_dataset)
```
```{r, fig.height = figure_height("O.2.2", course_dataset)}
report_question("O.2.2", course_dataset)
```
```{r, fig.height = figure_height("P.2.2", course_dataset)}
report_question("P.2.2", course_dataset)
```
```{r, fig.height = figure_height("Q.2.2", course_dataset)}
report_question("Q.2.2", course_dataset)
```

\pagebreak

#Assessment and feedback
Some introductory text about the section

```{r, fig.height = figure_height("C.1", course_dataset)}
report_question("C.1", course_dataset)
```

```{r, fig.height = figure_height("N.3.1", course_dataset)}
report_question("N.3.1", course_dataset)
```
```{r, fig.height = figure_height("O.3.1", course_dataset)}
report_question("O.3.1", course_dataset)
```
```{r, fig.height = figure_height("P.3.1", course_dataset)}
report_question("P.3.1", course_dataset)
```
```{r, fig.height = figure_height("Q.3.1", course_dataset)}
report_question("Q.3.1", course_dataset)
```

\pagebreak

#Teaching/learning and supervision
Some introductory text about the section
```{r, fig.height = figure_height("L.4", course_dataset)}
report_question("L.4", course_dataset)
```
```{r, fig.height = figure_height("L.5", course_dataset)}
report_question("L.5", course_dataset)
```

##Teaching/learning
```{r, fig.height = figure_height("N.4.1", course_dataset)}
report_question("N.4.1", course_dataset)
```
```{r, fig.height = figure_height("O.4.1", course_dataset)}
report_question("O.4.1", course_dataset)
```
```{r, fig.height = figure_height("P.4.1", course_dataset)}
report_question("P.4.1", course_dataset)
```
```{r, fig.height = figure_height("Q.4.1", course_dataset)}
report_question("Q.4.1", course_dataset)
```

\pagebreak

#Internship/field experience and personal development
Some introductory text about the section

```{r, fig.height = figure_height("L.2.a", course_dataset)}
report_question("L.2.a", course_dataset)
```
```{r, fig.height = figure_height("L.3.a", course_dataset)}
report_question("L.3.a", course_dataset)
```
```{r, fig.height = figure_height("L.6", course_dataset)}
report_question("L.6", course_dataset)
```

\pagebreak

#Concluding remarks
Some concluding remarks